<!DOCTYPE html>
<html>
<head>
	<title>Local Roads Selector Test</title>
	<style>
		html
		{
			font-family: 'Segoe UI', Arial, sans-serif;
			background: white;
			color: Black;
		}
		#map 
		{
			width: 640px;
			height: 480px;
		}
		.ui-button-text 
		{
			font-size: 0.7em;
		}
		.ui-local-roads-selector-tooltip 
		{
			border: 1px solid #222222;
			color: #222222;
			background: rgb(240,240,240);
			font-size: 0.7em;
		}
	</style>
	<!-- This stylesheet (or one from another theme) is required for the jQuery plug-in. -->
	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/themes/base/jquery-ui.css" type="text/css" media="all" />
</head>
<body>
	<h1>Local Roads Selector Test</h1>
	<p>This page demonstrates how to use the localRoadsSelector.js jQuery widget.  View the page's source for details. </p>
	<h2>Instructions</h2>
	<ol>
		<li>Zoom into the map.</li>
		<li>Click on an intersection to find the first point of the route.</li>
		<li>Click additional intersections to generate a route.</li>
	</ol>
	<div id="map"></div>
	<div id="localStorageSection">
		<button id="saveButton" title="Save route graphics to localStorage.">Save</button>
		<button id="loadButton" title="Load route graphics from localStorage.">Load</button>
	</div>
	<div id="debugSection">
		<h2>Debug</h2>
		<p>These buttons will send information to the debug console.</p>
		<button id="getRoutesButton" title="Sends route graphics to the debug console.">Get Routes</button>
	</div>
	
	<!-- Note the script prerequisites. -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/jquery-ui.min.js" type="text/javascript"></script>
	<script>
		// Setup custom dojo package paths.
		var dojoConfig = {
			packages: [
				{
					"name": "ogc",
					"location": location.pathname.replace(/\/[^/]+$/, "") + "/scripts/ogc"
				}
			]
		};
	</script>
	<script type="text/javascript" src="//serverapi.arcgisonline.com/jsapi/arcgis/?v=3.1compact"></script>
	<script src="../Scripts/arcGisMap.js" type="text/javascript"></script>
	
	<script src="scripts/proj4js/proj4js-compressed.js" type="text/javascript"></script>
	<script src="scripts/proj4js/defs/EPSG2927.js" type="text/javascript"></script>
	<script src="scripts/proj4js/defs/EPSG3857.js" type="text/javascript"></script>
	<script src="scripts/clientProjection.js" type="text/javascript"></script>
	<script src="../Scripts/localRoadsSelector.js" type="text/javascript"></script>
	<script type="text/javascript">
		(function ($) {
			"use strict";
			$().ready(function () {
				var debugButtons = $("#debugSection button");
				$("#map").localRoadsSelector({
					reverseGeocodeHandlerUrl: "../ReverseGeocodeIntersection.ashx",
					routeTaskUrl: "http://tasks.arcgisonline.com/ArcGIS/rest/services/NetworkAnalysis/ESRI_Route_NA/NAServer/Route",
					layers: [
						{
							url: "http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/",
							type: "esri.layers.ArcGISTiledMapServiceLayer"
						}
					],
					intersectionFound: function (event, intersection) {
						//console.log(intersection.geometry, new ogc.SimpleGeometry(intersection.geometry).toEsriGeometry());
					},
					routeFound: function (event, route) {
						//console.log(route.geometry, new ogc.SimpleGeometry(route.geometry).toEsriGeometry());
					},
					resizeWithWindow: false
				});

				if (console !== undefined && typeof (console.log) === "function") {
					debugButtons.button();

					$("#getRoutesButton").click(function (evt) {
						var routes = $("#map").localRoadsSelector("getRoutes");
						if (routes !== null && routes.length > 0) {
							console.log(routes);
						} else {
							console.log("No routes have been defined.");
						}
					});
				} else {
					debugButtons.attr("disabled", true);
				}

				if (localStorage !== undefined) {
					// Set up the save button.
					$("#saveButton").button({
						icons: {
							primary: "ui-icon-arrowstop-1-s",
							
						}
					}).click(function(){
						var routes = $("#map").localRoadsSelector("getRoutes");
						// Remove the geometry property for each route.
						for (var i = 0, l = routes.length; i < l; i++) {
							delete routes[i].geometry;
							delete routes[i].symbol;
							delete routes[i].infoTemplate;
						}
						localStorage.setItem("routes", JSON.stringify(routes));
					});

					// Set up the load button.
					$("#loadButton").button({
						icons: {
							primary: "ui-icon-arrowstop-1-n"
						}
					}).click(function(){
						var routes = localStorage.routes;
						if (routes) {
							routes = JSON.parse(routes);
							$("#map").localRoadsSelector("addRoutes", routes);
						}
					});
				} else {
					$("button", "#localStorageSection").attr("disabled", true);
				}
			});
		} (jQuery));
	</script>
</body>
</html>
